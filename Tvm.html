<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Télécommande</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { font-family: 'Inter', sans-serif; }
        body { background-color: #111827; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 16px; }
        
        /* Carte Principale */
        .control-card { 
            background: linear-gradient(145deg, #1f2937, #111827); 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); 
            border: 1px solid #374151;
            max-width: 400px; 
            width: 100%; 
        }
        
        /* Styles des boutons */
        .control-button { transition: transform 0.1s; border: 1px solid rgba(255,255,255,0.1); }
        .control-button:active { transform: scale(0.95); }
        
        /* Header (ON - TV - OFF) */
        .header-btn { height: 55px; border-radius: 12px; font-weight: 700; border: none; }
        .btn-tv { background-color: #2563EB; color: white; font-size: 1.1rem; }
        .btn-on { background-color: #059669; color: white; font-size: 0.9rem; }
        .btn-off { background-color: #DC2626; color: white; font-size: 0.9rem; }

        /* --- GRILLE CHAINES --- */
        .channel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-bottom: 15px; }
        .channel-btn { 
            background-color: #ffffff; 
            height: 45px; 
            border-radius: 8px;
            position: relative;
            display: flex; 
            align-items: center; 
            justify-content: center;
            color: #374151; /* Couleur du texte si pas d'image */
            font-weight: 800;
            font-size: 0.7rem;
            text-align: center;
            overflow: hidden;
        }
        /* Gestion de l'image et du texte de secours */
        .channel-btn img {
            position: absolute;
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            z-index: 2;
        }
        /* Le texte "alt" s'affiche si l'image plante */
        .channel-btn span.fallback-text {
            z-index: 1;
            display: block;
            width: 100%;
        }
        .channel-num {
            position: absolute;
            top: 1px;
            left: 3px;
            font-size: 0.5rem;
            font-weight: 900;
            color: #cbd5e1;
            z-index: 10;
        }

        /* --- NOUVEAUX BOUTONS VOLUME (JAUNE) --- */
        .volume-container {
            background-color: #374151;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .vol-btn {
            background-color: #FACC15; /* Jaune intense */
            color: #000000;
            font-weight: 900;
            font-size: 1rem;
            height: 50px;
            border-radius: 8px;
            flex: 1;
            margin: 0 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }
        .vol-btn:active { background-color: #EAB308; }

        /* Chaines P+/P- */
        .ch-btn {
            background-color: #3B82F6;
            color: white;
            font-weight: 800;
            border-radius: 8px;
            height: 50px;
            flex: 1;
            margin: 0 4px;
        }

        /* Navigation */
        .nav-grid { grid-template-areas: ". up ." "left ok right" ". down ."; width: 160px; height: 160px; margin: 0 auto; }
        .nav-btn { background-color: #374151; color: white; border-radius: 50%; border: none; }
        .nav-btn-ok { background-color: #4B5563; border: 2px solid #9CA3AF; border-radius: 50%; }
        
        .loading { opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>
    <div id="app-container" class="control-card p-5 rounded-3xl">
        
        <div class="flex justify-between items-center space-x-2 mb-5">
            <button data-key="on" data-capability="switch" class="control-button header-btn btn-on w-16">ON</button>
            <button id="launch-oqee-btn" data-app-id="znCs95n93Q.OqeeTV" data-capability="custom.launchapp" 
                    class="control-button header-btn btn-tv flex-grow">LANCER TV</button>
            <button data-key="off" data-capability="switch" class="control-button header-btn btn-off w-16">OFF</button>
        </div>

        <div class="mb-4">
            <div class="channel-grid">
                <button class="control-button channel-btn" data-channel="1"><span class="channel-num">1</span><span class="fallback-text">TF1</span><img src="https://upload.wikimedia.org/wikipedia/commons/7/75/TF1_logo_2013.svg" onerror="this.style.display='none'" alt="TF1"></button>
                <button class="control-button channel-btn" data-channel="2"><span class="channel-num">2</span><span class="fallback-text">FR 2</span><img src="https://upload.wikimedia.org/wikipedia/commons/2/23/France_2_%282018%29.svg" onerror="this.style.display='none'" alt="FR2"></button>
                <button class="control-button channel-btn" data-channel="3"><span class="channel-num">3</span><span class="fallback-text">FR 3</span><img src="https://upload.wikimedia.org/wikipedia/commons/3/34/France_3_%282018%29.svg" onerror="this.style.display='none'" alt="FR3"></button>
                <button class="control-button channel-btn" data-channel="4"><span class="channel-num">4</span><span class="fallback-text">FR 4</span><img src="https://upload.wikimedia.org/wikipedia/commons/3/35/France_4_%282018%29.svg" onerror="this.style.display='none'" alt="FR4"></button>
                
                <button class="control-button channel-btn" data-channel="5"><span class="channel-num">5</span><span class="fallback-text">FR 5</span><img src="https://upload.wikimedia.org/wikipedia/commons/2/22/France_5_%282018%29.svg" onerror="this.style.display='none'" alt="FR5"></button>
                <button class="control-button channel-btn" data-channel="6"><span class="channel-num">6</span><span class="fallback-text">M6</span><img src="https://upload.wikimedia.org/wikipedia/fr/a/ad/Logo_M6_2009.svg" onerror="this.style.display='none'" alt="M6"></button>
                <button class="control-button channel-btn" data-channel="7"><span class="channel-num">7</span><span class="fallback-text">ARTE</span><img src="https://upload.wikimedia.org/wikipedia/commons/0/03/Arte_Logo.svg" onerror="this.style.display='none'" alt="ARTE"></button>
                <button class="control-button channel-btn" data-channel="8"><span class="channel-num">8</span><span class="fallback-text">LCP</span><img src="https://upload.wikimedia.org/wikipedia/fr/3/30/LCP_2019.svg" onerror="this.style.display='none'" alt="LCP"></button>
                
                <button class="control-button channel-btn" data-channel="9"><span class="channel-num">9</span><span class="fallback-text">W9</span><img src="https://upload.wikimedia.org/wikipedia/commons/0/04/W9_logo_2018.svg" onerror="this.style.display='none'" alt="W9"></button>
                <button class="control-button channel-btn" data-channel="10"><span class="channel-num">10</span><span class="fallback-text">TMC</span><img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/TMC_Logo.svg" onerror="this.style.display='none'" alt="TMC"></button>
                <button class="control-button channel-btn" data-channel="11"><span class="channel-num">11</span><span class="fallback-text">TFX</span><img src="https://upload.wikimedia.org/wikipedia/commons/e/e6/TFX_2018.svg" onerror="this.style.display='none'" alt="TFX"></button>
                <button class="control-button channel-btn" data-channel="12"><span class="channel-num">12</span><span class="fallback-text">GULLI</span><img src="https://upload.wikimedia.org/wikipedia/commons/3/31/Gulli_2017.svg" onerror="this.style.display='none'" alt="GULLI"></button>
                
                <button class="control-button channel-btn" data-channel="13"><span class="channel-num">13</span><span class="fallback-text">BFM</span><img src="https://upload.wikimedia.org/wikipedia/commons/4/4d/BFM_TV_2019.svg" onerror="this.style.display='none'" alt="BFM"></button>
                <button class="control-button channel-btn" data-channel="14"><span class="channel-num">14</span><span class="fallback-text">CNEWS</span><img src="https://upload.wikimedia.org/wikipedia/commons/3/31/CNews_Logo.svg" onerror="this.style.display='none'" alt="CNEWS"></button>
                <button class="control-button channel-btn" data-channel="15"><span class="channel-num">15</span><span class="fallback-text">LCI</span><img src="https://upload.wikimedia.org/wikipedia/commons/4/4d/Logo_LCI_2017.svg" onerror="this.style.display='none'" alt="LCI"></button>
                <button class="control-button channel-btn" data-channel="16"><span class="channel-num">16</span><span class="fallback-text">INFO</span><img src="https://upload.wikimedia.org/wikipedia/commons/0/0e/Franceinfo_-_2016.svg" onerror="this.style.display='none'" alt="INFO"></button>

                <button class="control-button channel-btn" data-channel="17"><span class="channel-num">17</span><span class="fallback-text">CSTAR</span><img src="https://upload.wikimedia.org/wikipedia/commons/5/54/CStar_Logo.svg" onerror="this.style.display='none'" alt="CSTAR"></button>
                 <button class="control-button channel-btn" data-channel="20"><span class="channel-num">20</span><span class="fallback-text">TF1 SF</span><img src="https://upload.wikimedia.org/wikipedia/commons/4/41/TF1_Series_Films_2018.svg" onerror="this.style.display='none'" alt="TF1SF"></button>
                 <button class="control-button channel-btn" data-channel="21"><span class="channel-num">21</span><span class="fallback-text">L'EQUIPE</span><img src="https://upload.wikimedia.org/wikipedia/commons/3/32/L%27%C3%89quipe_logo.svg" onerror="this.style.display='none'" alt="EQUIPE"></button>
                 <button class="control-button channel-btn" data-channel="40"><span class="channel-num">40</span><span class="fallback-text">CANAL+</span><img src="https://upload.wikimedia.org/wikipedia/commons/b/b1/Canal%2B_logo_2016.svg" onerror="this.style.display='none'" alt="CANAL+"></button>
            </div>
        </div>

        <div class="flex items-center space-x-2 mb-6">
             <div class="volume-container flex-1">
                <button data-command="volumeDown" data-capability="audioVolume" class="control-button vol-btn">VOL -</button>
                <button data-command="volumeUp" data-capability="audioVolume" class="control-button vol-btn">VOL +</button>
             </div>
             
             <div class="flex-1 flex">
                 <button data-command="channelDown" data-capability="tvChannel" class="control-button ch-btn">P-</button>
                 <button data-command="channelUp" data-capability="tvChannel" class="control-button ch-btn">P+</button>
             </div>
        </div>
        
        <div class="grid grid-cols-4 gap-2 mb-6">
             <button data-command="mute" data-capability="audioMute" class="col-span-2 control-button header-btn" style="background-color: #374151; color: #e5e7eb;">MUTE</button>
             <button data-command="play" data-capability="mediaPlayback" class="control-button header-btn" style="background-color: #374151; color: #e5e7eb;">PLAY</button>
             <button data-command="pause" data-capability="mediaPlayback" class="control-button header-btn" style="background-color: #374151; color: #e5e7eb;">PAUSE</button>
         </div>

        <div class="flex justify-center mb-2">
            <div class="nav-grid grid grid-cols-3 gap-2 p-2 rounded-2xl">
                <button data-key-code="UP" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: up;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg></button>
                <button data-key-code="LEFT" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: left;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M14 7l-5 5 5 5z"/></svg></button>
                <button data-key-code="ENTER" data-capability="samsungvd.remoteControl" class="control-button nav-btn-ok rounded-full h-12 w-12 mx-auto text-xs font-bold shadow-md" style="grid-area: ok;">OK</button>
                <button data-key-code="RIGHT" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: right;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17l5-5-5-5z"/></svg></button>
                <button data-key-code="DOWN" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: down;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg></button>
            </div>
        </div>

        <div id="status-message" class="text-gray-500 text-xs text-center mt-2 h-4">Prêt</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const statusMessage = document.getElementById('status-message');
            const controlButtons = document.querySelectorAll('.control-button');

            const SMARTTHINGS_TOKEN = "e0d3e9e3-8cb6-4262-b867-11496b450832"; 
            const TV_DEVICE_ID = "a446a209-f9d7-7972-e908-a1a41eb7f093"; 
            const COMMAND_API_URL = `https://api.smartthings.com/v1/devices/${TV_DEVICE_ID}/commands`;
            
            let isSendingCommand = false;

            function setAllButtonsDisabled(disabled) {
                controlButtons.forEach(btn => btn.classList.toggle('loading', disabled));
                isSendingCommand = disabled;
            }

            function updateStatus(message, isError = false) {
                statusMessage.style.color = isError ? '#f87171' : (message.includes('OK') ? '#4ade80' : '#9ca3af');
                statusMessage.innerHTML = message;
            }

            async function sendApiRequest(commandBody) {
                const response = await fetch(COMMAND_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SMARTTHINGS_TOKEN}`,
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({ commands: commandBody })
                });

                if (!response.ok) {
                    throw new Error(`Erreur ${response.status}`);
                }
            }

            async function sendCommand(commands, description, throttleTime = 500) {
                if (isSendingCommand) return;
                
                updateStatus(`Envoi...`);
                setAllButtonsDisabled(true); 

                try {
                    await sendApiRequest(commands);
                    updateStatus(`OK`, false);
                } catch (error) {
                    updateStatus(`Erreur`, true);
                } finally {
                    setTimeout(() => {
                        setAllButtonsDisabled(false);
                        updateStatus("Prêt");
                    }, throttleTime);
                }
            }

            controlButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const command = button.getAttribute('data-command'); 
                    const capability = button.getAttribute('data-capability');
                    const keyName = button.getAttribute('data-key'); 
                    const keyCode = button.getAttribute('data-key-code');
                    const channelNum = button.getAttribute('data-channel');
                    
                    let commandsBody = [];
                    let throttle = 300; 

                    if (channelNum) {
                        const digits = channelNum.split('');
                        digits.forEach(digit => {
                            commandsBody.push({
                                component: "main",
                                capability: "samsungvd.remoteControl",
                                command: "send",
                                arguments: [digit]
                            });
                        });
                        throttle = 600;
                    }
                    else if (capability === "samsungvd.remoteControl") {
                        commandsBody = [{ component: "main", capability: "samsungvd.remoteControl", command: "send", arguments: [keyCode] }];
                    } 
                    else if (capability === "switch") {
                        throttle = 2000;
                        commandsBody = [{ component: "main", capability: "switch", command: keyName, arguments: [] }];
                    } 
                    else if (capability === "custom.launchapp") {
                        const appId = button.getAttribute('data-app-id');
                        throttle = 2000;
                        commandsBody = [{ component: "main", capability: "custom.launchapp", command: "launchApp", arguments: [appId] }];
                    }
                    else if (capability) {
                        commandsBody = [{ component: "main", capability: capability, command: command, arguments: [] }];
                    }
                    
                    if (commandsBody.length > 0) {
                        sendCommand(commandsBody, "", throttle);
                    }
                });
            });
        });
    </script>
</body>
</html>
