<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Télécommande OQEE TV (V7 - Logos)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { font-family: 'Inter', sans-serif; }
        body { background-color: #eef2f6; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 16px; }
        .control-card { background: linear-gradient(145deg, #ffffff, #f0f4f8); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15), 0 5px 15px rgba(0, 0, 0, 0.05); max-width: 420px; width: 100%; }
        
        /* Boutons Généraux */
        .control-button { transition: all 0.15s ease-in-out; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #e5e7eb; }
        .control-button:active { transform: scale(0.96); box-shadow: inset 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Styles Spécifiques */
        .app-launch-button-style { background-color: #3B82F6; color: white; font-weight: 700; font-size: 1.5rem; height: 70px; box-shadow: 0 6px 15px -3px rgba(59, 130, 246, 0.4); letter-spacing: 0.05em; border: none; }
        .power-on-style { background-color: #10B981; color: white; font-weight: 600; border: none; }
        .power-off-style { background-color: #EF4444; color: white; font-weight: 600; border: none; }
        
        /* Navigation */
        .nav-grid { grid-template-areas: ". up ." "left ok right" ". down ."; width: 180px; height: 180px; margin: 0 auto; }
        .nav-btn { background-color: #4f46e5; color: white; border: none; box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3); }
        .nav-btn-ok { background-color: #10b981; border: none; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3); }
        
        /* Ronds & Media */
        .round-button { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .volume-button { background-color: #fcd34d; color: #4b5563; font-weight: 800; border: none; }
        .essential-button { background-color: #ffffff; color: #374151; font-size: 0.9rem; height: 45px; font-weight: 600; }

        /* --- NOUVEAU DESIGN BOUTONS CHAINES (LOGOS) --- */
        .channel-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 20px; }
        .channel-btn { 
            background-color: #ffffff; 
            height: 50px; 
            border-radius: 10px;
            position: relative;
            display: flex; 
            align-items: center; 
            justify-content: center;
            padding: 6px;
            overflow: hidden;
        }
        /* Le logo à l'intérieur */
        .channel-btn img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            pointer-events: none; /* Empêche de glisser l'image */
        }
        /* Le petit numéro en haut à gauche */
        .channel-num {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 0.55rem;
            font-weight: 700;
            color: #cbd5e1;
            line-height: 1;
        }

        .loading { cursor: not-allowed; opacity: 0.5; filter: grayscale(100%); pointer-events: none; }
    </style>
</head>
<body class="selection:bg-indigo-200">
    <div id="app-container" class="control-card p-5 rounded-3xl border border-gray-200">
        
        <div class="flex items-center justify-center mb-4">
             <h1 class="text-xl font-bold text-gray-800">OQEE Remote</h1>
        </div>
        
        <div class="grid grid-cols-2 gap-3 mb-5">
            <button id="launch-oqee-btn" data-app-id="znCs95n93Q.OqeeTV" data-capability="custom.launchapp" 
                    class="col-span-2 control-button app-launch-button-style rounded-2xl flex items-center justify-center">
                <span>TV</span> 
            </button>
            <button data-key="on" data-capability="switch" class="control-button power-on-style rounded-xl h-12 text-sm">ON</button>
            <button data-key="off" data-capability="switch" class="control-button power-off-style rounded-xl h-12 text-sm">OFF</button>
        </div>

        <div class="mb-6">
            <div class="channel-grid">
                <button class="control-button channel-btn" data-channel="1">
                    <span class="channel-num">1</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/75/TF1_logo_2013.svg/320px-TF1_logo_2013.svg.png" alt="TF1">
                </button>
                <button class="control-button channel-btn" data-channel="2">
                    <span class="channel-num">2</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/France_2_%282018%29.svg/320px-France_2_%282018%29.svg.png" alt="France 2">
                </button>
                <button class="control-button channel-btn" data-channel="3">
                    <span class="channel-num">3</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/France_3_%282018%29.svg/320px-France_3_%282018%29.svg.png" alt="France 3">
                </button>
                <button class="control-button channel-btn" data-channel="4">
                    <span class="channel-num">4</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/Canal%2B_logo_2016.svg/320px-Canal%2B_logo_2016.svg.png" alt="Canal+">
                </button>
                
                <button class="control-button channel-btn" data-channel="5">
                    <span class="channel-num">5</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/France_5_%282018%29.svg/320px-France_5_%282018%29.svg.png" alt="France 5">
                </button>
                <button class="control-button channel-btn" data-channel="6">
                    <span class="channel-num">6</span>
                    <img src="https://upload.wikimedia.org/wikipedia/fr/thumb/a/ad/Logo_M6_2009.svg/320px-Logo_M6_2009.svg.png" alt="M6">
                </button>
                <button class="control-button channel-btn" data-channel="7">
                    <span class="channel-num">7</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/03/Arte_Logo.svg/320px-Arte_Logo.svg.png" alt="Arte">
                </button>
                <button class="control-button channel-btn" data-channel="8">
                    <span class="channel-num">8</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/C8_Logo.svg/320px-C8_Logo.svg.png" alt="C8">
                </button>
                
                <button class="control-button channel-btn" data-channel="9">
                    <span class="channel-num">9</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/04/W9_logo_2018.svg/320px-W9_logo_2018.svg.png" alt="W9">
                </button>
                <button class="control-button channel-btn" data-channel="10">
                    <span class="channel-num">10</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/TMC_Logo.svg/320px-TMC_Logo.svg.png" alt="TMC">
                </button>
                <button class="control-button channel-btn" data-channel="11">
                    <span class="channel-num">11</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/TFX_2018.svg/320px-TFX_2018.svg.png" alt="TFX">
                </button>
                <button class="control-button channel-btn" data-channel="12">
                    <span class="channel-num">12</span>
                    <img src="https://upload.wikimedia.org/wikipedia/fr/thumb/0/07/NRJ_12_2015.svg/320px-NRJ_12_2015.svg.png" alt="NRJ12">
                </button>
                
                <button class="control-button channel-btn" data-channel="13">
                    <span class="channel-num">13</span>
                    <img src="https://upload.wikimedia.org/wikipedia/fr/thumb/3/30/LCP_2019.svg/320px-LCP_2019.svg.png" alt="LCP">
                </button>
                <button class="control-button channel-btn" data-channel="14">
                    <span class="channel-num">14</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/France_4_%282018%29.svg/320px-France_4_%282018%29.svg.png" alt="France 4">
                </button>
                <button class="control-button channel-btn" data-channel="15">
                    <span class="channel-num">15</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4d/BFM_TV_2019.svg/320px-BFM_TV_2019.svg.png" alt="BFMTV">
                </button>
                <button class="control-button channel-btn" data-channel="16">
                    <span class="channel-num">16</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/CNews_Logo.svg/320px-CNews_Logo.svg.png" alt="CNews">
                </button>

                <button class="control-button channel-btn" data-channel="17">
                    <span class="channel-num">17</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/54/CStar_Logo.svg/320px-CStar_Logo.svg.png" alt="CStar">
                </button>
                 <button class="control-button channel-btn" data-channel="18">
                    <span class="channel-num">18</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Gulli_2017.svg/320px-Gulli_2017.svg.png" alt="Gulli">
                </button>
                 <button class="control-button channel-btn" data-channel="20">
                    <span class="channel-num">20</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/41/TF1_Series_Films_2018.svg/320px-TF1_Series_Films_2018.svg.png" alt="TF1 SF">
                </button>
                 <button class="control-button channel-btn" data-channel="21">
                    <span class="channel-num">21</span>
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/32/L%27%C3%89quipe_logo.svg/320px-L%27%C3%89quipe_logo.svg.png" alt="L'Equipe">
                </button>
            </div>
        </div>

        <div class="flex justify-center mb-6">
            <div class="nav-grid grid grid-cols-3 gap-2 p-2 bg-gray-100 rounded-2xl border border-gray-200">
                <button data-key-code="UP" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: up;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5z"/></svg></button>
                <button data-key-code="LEFT" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: left;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M14 7l-5 5 5 5z"/></svg></button>
                <button data-key-code="ENTER" data-capability="samsungvd.remoteControl" class="control-button nav-btn-ok rounded-full h-12 w-12 mx-auto text-xs font-bold shadow-md" style="grid-area: ok;">OK</button>
                <button data-key-code="RIGHT" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: right;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M10 17l5-5-5-5z"/></svg></button>
                <button data-key-code="DOWN" data-capability="samsungvd.remoteControl" class="control-button nav-btn rounded-full h-10 w-10 mx-auto" style="grid-area: down;"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mx-auto" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg></button>
            </div>
        </div>

        <div class="flex justify-between items-center space-x-2">
            <div class="flex flex-col space-y-2">
                <button data-command="volumeUp" data-capability="audioVolume" class="control-button volume-button round-button shadow-sm">+</button>
                <button data-command="volumeDown" data-capability="audioVolume" class="control-button volume-button round-button shadow-sm">-</button>
             </div>
             
             <div class="grid grid-cols-2 gap-2">
                 <button data-command="mute" data-capability="audioMute" class="col-span-2 control-button essential-button rounded-lg">MUTE</button>
                 <button data-command="play" data-capability="mediaPlayback" class="control-button essential-button rounded-lg text-xs">PLAY</button>
                 <button data-command="pause" data-capability="mediaPlayback" class="control-button essential-button rounded-lg text-xs">PAUSE</button>
             </div>

             <div class="flex flex-col space-y-2">
                 <button data-command="channelUp" data-capability="tvChannel" class="control-button app-launch-button-style round-button w-[55px] h-[55px] bg-green-500 text-base shadow-sm">P+</button>
                 <button data-command="channelDown" data-capability="tvChannel" class="control-button app-launch-button-style round-button w-[55px] h-[55px] bg-green-500 text-base shadow-sm">P-</button>
             </div>
        </div>

        <div id="status-message" class="text-gray-500 text-xs text-center mt-4 h-4">Prêt</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const statusMessage = document.getElementById('status-message');
            const controlButtons = document.querySelectorAll('.control-button');

            // --- JETON E0D3 ---
            const SMARTTHINGS_TOKEN = "e0d3e9e3-8cb6-4262-b867-11496b450832"; 
            const TV_DEVICE_ID = "a446a209-f9d7-7972-e908-a1a41eb7f093"; 
            const COMMAND_API_URL = `https://api.smartthings.com/v1/devices/${TV_DEVICE_ID}/commands`;
            
            let isSendingCommand = false;

            function setAllButtonsDisabled(disabled) {
                controlButtons.forEach(btn => btn.classList.toggle('loading', disabled));
                isSendingCommand = disabled;
            }

            function updateStatus(message, isError = false) {
                statusMessage.style.color = isError ? 'red' : (message.includes('succès') ? 'green' : 'gray');
                statusMessage.innerHTML = message;
            }

            async function sendApiRequest(commandBody) {
                const response = await fetch(COMMAND_API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${SMARTTHINGS_TOKEN}`,
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    body: JSON.stringify({ commands: commandBody })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || `Erreur ${response.status}`);
                }
            }

            async function sendCommand(commands, description, throttleTime = 500) {
                if (isSendingCommand) return;
                
                updateStatus(`Envoi...`);
                setAllButtonsDisabled(true); 

                try {
                    await sendApiRequest(commands);
                    updateStatus(`OK`, false);
                } catch (error) {
                    updateStatus(`Erreur`, true);
                    console.error(error);
                } finally {
                    setTimeout(() => {
                        setAllButtonsDisabled(false);
                        updateStatus("Prêt");
                    }, throttleTime);
                }
            }

            controlButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const command = button.getAttribute('data-command'); 
                    const capability = button.getAttribute('data-capability');
                    const keyName = button.getAttribute('data-key'); 
                    const keyCode = button.getAttribute('data-key-code');
                    const channelNum = button.getAttribute('data-channel');
                    
                    let commandsBody = [];
                    let throttle = 300; 

                    // GESTION CHAINES (LOGOS)
                    if (channelNum) {
                        const digits = channelNum.split('');
                        digits.forEach(digit => {
                            commandsBody.push({
                                component: "main",
                                capability: "samsungvd.remoteControl",
                                command: "send",
                                arguments: [digit]
                            });
                        });
                        throttle = 600;
                    }
                    else if (capability === "samsungvd.remoteControl") {
                        commandsBody = [{ component: "main", capability: "samsungvd.remoteControl", command: "send", arguments: [keyCode] }];
                    } 
                    else if (capability === "switch") {
                        throttle = 2000;
                        commandsBody = [{ component: "main", capability: "switch", command: keyName, arguments: [] }];
                    } 
                    else if (capability === "custom.launchapp") {
                        const appId = button.getAttribute('data-app-id');
                        throttle = 2000;
                        commandsBody = [{ component: "main", capability: "custom.launchapp", command: "launchApp", arguments: [appId] }];
                    }
                    else if (capability) {
                        commandsBody = [{ component: "main", capability: capability, command: command, arguments: [] }];
                    }
                    
                    if (commandsBody.length > 0) {
                        sendCommand(commandsBody, "", throttle);
                    }
                });
            });
        });
    </script>
</body>
</html>
